# SOP 7-Layer Test Case Generation Framework

These layers are **guiding frameworks**, not rigid templates. Adapt each layer to the specific requirement type. If the requirement doesn't include functionality for a layer, skip it entirely and return an empty array.

## Layer Overview

| Layer | Name | When to Apply |
|-------|------|--------------|
| L0 | 基础验证层 | Always — any UI has permissions and standards |
| L1 | 展示层 | Any data display interface (list, card, dashboard, report) |
| L2 | 交互筛选层 | Any search, filter, sort, or export functionality |
| L3 | 数据输入层 | Any create/add/import/bulk-create functionality |
| L4 | 数据修改层 | Any edit/modify/status-change functionality |
| L5 | 业务规则层 | Any approval flow, state machine, calculation, integration |
| L6 | 数据清理层 | Any delete/void/archive/undo functionality |

---

## L0 基础验证层 (Base Verification)

Always generate these for every module:

1. **菜单权限** — 有权限用户可正常访问; 无权限用户不可访问或菜单置灰
2. **数据权限** — 不同角色看到的数据范围正确 (如管理员看全部, 普通用户看自己的)
3. **UI规范** — 文字描述使用中文标点; 系统中无错别字; 可点击元素显示手型光标; 字体大小/间距/样式与设计一致
4. **数据来源** — 列表数据来源于正确的业务模块

测试点命名: "菜单权限", "数据权限", "系统整体要求UI", "数据来源"

---

## L1 展示层 (Display)

For any data display interface:

1. **页面布局检查** — 页面整体样式/排版/名称/字段显示正确(参考原型)
2. **列表字段检查** — 列表字段名与需求字段说明一致, 字段顺序正确
3. **列表按钮检查** — 操作列按钮完整, 不同状态下按钮显示/隐藏/置灰正确
4. **分页功能** — 上一页/下一页/跳页/每页条数切换/首页/末页/边界页码
5. **数据排序** — 默认排序规则正确; 列头排序功能(升序/降序)
6. **数据为空** — 列表无数据时显示"暂无数据"或空状态提示
7. **页面切换** — 从其他页面切换回来保留原页面数据和状态

测试点命名: "页面布局与显示", "列表字段检查", "按钮检查", "分页功能", "数据排序", "空数据展示", "页面切换"

---

## L2 交互筛选层 (Interactive Filtering)

For each search/filter component in the requirement:

1. **关键字搜索**
   - 输入有效关键字搜索 → 显示匹配结果
   - 输入无效关键字搜索 → 显示暂无数据
   - 不输入直接搜索 → 列表不变或显示全部
   - 输入特殊字符搜索 → 不报错, 显示无数据或提示
   - 输入超长字符串搜索 → 限制输入或提示过长

2. **下拉筛选** (为需求中每个筛选项生成)
   - 默认值正确
   - 选择每个选项后列表正确过滤
   - 快速连续切换选项, 结果正确更新

3. **日期范围选择**
   - 选择有效日期范围 → 显示范围内数据
   - 选择无效范围(开始>结束) → 提示错误或无数据

4. **组合查询** — 多个筛选条件叠加, 结果为各条件交集
5. **清空/重置** — 清空所有筛选条件, 恢复默认状态

测试点命名: "搜索框功能", "{字段名}筛选", "日期范围选择", "组合查询", "清空/重置"

---

## L3 数据输入层 (Data Input)

**核心原则**: 遍历需求字段说明表中的每个字段, 根据字段类型生成对应的验证用例。

### 按字段类型生成:

**文本输入框**:
- 输入正常值保存成功
- 不输入(必填字段) → 提示必填
- 输入特殊字符 → 根据业务规则判断
- 输入超长字符串 → 提示过长或截断
- 输入空格 → 提示不能为空或去除空格

**下拉选择框**:
- 选择每个选项, 保存成功
- 不选择(必填) → 提示必填
- 联动字段: 选择A选项后B字段显示/隐藏/值变化

**日期选择器**:
- 选择有效日期保存成功
- 不选择(必填) → 提示必填

**数值输入框**:
- 输入正常数值保存成功
- 输入0 → 根据业务判断
- 输入负数 → 提示或允许
- 输入超大数值 → 提示或限制
- 输入小数 → 根据精度要求判断
- 输入非数字字符 → 提示格式错误

**附件上传**:
- 上传允许格式的文件成功
- 上传不允许格式 → 提示格式错误
- 上传超大文件 → 提示大小限制
- 批量上传

**多行文本 (textarea)**:
- 输入正常多行内容保存成功, 换行保留
- 不输入(必填字段) → 提示必填
- 输入超长文本 → 提示过长或截断
- 字数统计功能(如有) → 计数准确, 达到上限时提示

**单选框组 (radio)**:
- 每个选项均可正常选中
- 不选择(必填) → 提示必填
- 检查默认选中值是否正确
- 切换选项后联动字段正确响应

**复选框/开关 (checkbox/toggle)**:
- 勾选/取消操作正常
- 默认勾选状态正确
- 勾选后联动子字段组显示/变为必填; 取消后子字段隐藏/变为非必填
- 多个复选框的独立性(勾选A不影响B)

**搜索选择框**:
- 输入关键字 → 下拉展示匹配结果
- 从下拉中选择 → 自动填充到字段(及关联字段)
- 输入无匹配关键字 → 显示无结果提示
- 清空已选值后重新搜索选择
- 不输入(必填) → 提示必填

**下拉多选**:
- 选择单个选项保存成功
- 选择多个选项保存成功, 已选项正确回显
- 全选/取消部分选项/清空所有选项
- 不选择(必填) → 提示必填

**日期范围选择器**:
- 选择有效日期范围(开始≤结束)保存成功
- 选择无效范围(开始>结束) → 提示错误或自动纠正
- 只选择开始/只选择结束 → 根据业务规则判断
- 不选择(必填) → 提示必填

### 跨字段验证:
- 字段联动逻辑 (如: 选择"已注册"时企业全称变为搜索选择; 选择"未注册"时变为手动输入)
- 唯一性校验 (如: 企业全称/简称不可重复)
- 提交后数据校验 (新增的数据在列表中正确显示)

### 跨字段交互模式:

**条件显隐**:
- 字段A=某值时, 字段B/字段组显示; A≠该值时B隐藏
- 切换A的值时, B中已填写的数据是否被清空(根据业务判断)
- 含角色/类型维度: 某类型/角色可见某字段, 其他不可见

**条件必填**:
- 父字段满足条件时, 子字段变为必填(不填提示必填)
- 父字段不满足条件时, 子字段变为非必填(不填可保存)

**级联数据带出**:
- 选择父实体后, 关联字段自动填充且变为只读
- 更换父实体后, 关联字段数据刷新为新值
- 清空父实体后, 关联字段清空

**表单内新增入口**:
- 点击"新增xx"按钮, 弹出子表单/弹窗
- 子表单保存成功后, 新数据自动选中到父字段
- 子表单取消后, 父字段不变

测试点命名: "{字段名}字段", "字段联动-{描述}", "提交保存", "唯一性校验"

---

## L4 数据修改层 (Data Modification)

1. **编辑回显** — 打开编辑弹窗/页面, 所有字段正确回显已有数据
2. **可编辑字段** — 修改可编辑字段后保存成功, 列表数据更新
3. **只读字段** — 不可编辑字段确认为只读状态(置灰/无输入框)
4. **状态限制** — 不同状态下编辑权限不同
   - 如: 已入库项目不可编辑某些字段
   - 如: 审批中的记录不可修改
5. **修改后验证** — 修改保存后返回列表, 数据已更新

测试点命名: "编辑回显检查", "{字段名}修改", "只读字段检查", "状态限制-{状态名}", "修改保存验证"

---

## L5 业务规则层 (Business Rules)

根据需求中描述的业务逻辑生成, 常见类型:

1. **审批流程**
   - 提交审批 → 状态变为审批中
   - 审批通过 → 状态变更, 触发后续操作
   - 审批驳回 → 状态回退, 可重新提交
   - 撤回审批 → 取消已提交的审批

2. **状态流转**
   - 验证每个状态转换路径
   - 验证不允许的状态转换被阻止
   - 状态变更后关联数据正确更新

3. **数据联动**
   - 操作A影响数据B的场景
   - 如: 入库审批通过后在项目管理列表新增一条记录

4. **计算规则**
   - 金额/比例等计算逻辑验证
   - 边界值验证

5. **其他领域特定逻辑** — 根据需求文档中的"业务逻辑说明"部分逐条生成

6. **临时状态/草稿暂存** (当需求文档明确提到草稿/暂存/自动保存时生成)
   - 部分填写后保存 → 保存成功, 状态为草稿
   - 关闭后重新打开 → 回显上次保存的数据
   - 草稿状态下继续编辑 → 修改正常生效
   - 草稿状态下提交 → 校验必填后正常提交
   - 取消编辑 → 不保存本次修改
   适用场景: 表单草稿、多步向导中间保存、购物车暂存等

测试点命名: "审批流程-{节点}", "状态流转-{从}到{到}", "数据联动-{描述}", "{业务规则名}", "草稿暂存"

---

## L6 数据清理层 (Data Cleanup)

1. **删除权限** — 有权限用户可删除; 无权限用户按钮不显示或置灰
2. **确认弹窗** — 点击删除弹出确认提示; 点击确认执行删除; 点击取消关闭弹窗
3. **状态限制** — 某些状态下不可删除(如已入库/审批中), 按钮置灰或隐藏
4. **删除后验证** — 删除成功后记录从列表消失; 列表刷新正确
5. **级联影响** — 删除记录后关联数据的处理(如有)

测试点命名: "删除权限检查", "删除确认弹窗", "删除状态限制", "删除后数据验证", "删除级联影响"

---

## Writing Guidelines

### 格式规范
- 操作步骤用 `\n` 分隔, 每步以 `N.` 开头 (如 `1.点击xxx\n2.输入xxx`)
- 预期结果与操作步骤一一对应, 同样用 `\n` 分隔编号
- 前提条件简洁明了, 须包含当前所在页面/弹窗位置, 如 "用户已登录并打开新增弹窗"
- 用例名称要具体, 体现测试的核心内容
- 一个测试用例可包含多个相关的检查步骤 (如搜索功能的多种输入情况)

### 质量要求
- 预期结果必须明确、可判定, 禁止"A 或 B"式模糊描述。如需求未明确预期行为, 标注 [TODO:待确认]
- 步骤中避免硬编码日期/金额等具体值, 使用"选择某有效日期"、"输入合理数值 如 100"等相对描述

### 用例精简规则
- **同类型同规则字段合并**: N 个字段如果控件类型相同、校验规则相同（如多个"自动带入且只读"字段）, 合并为 1 条用例, 步骤中逐一列出
- **下拉选项精简**: ≤5 个选项可逐一测试; >5 个选项选首项、末项、中间代表项, 合并为 1 条
- **相似场景合并**: 多个子模块如果有完全相同的操作模式（如多个表单都有"取消不保存"）, 可用 1 条通用用例覆盖并注明适用范围
